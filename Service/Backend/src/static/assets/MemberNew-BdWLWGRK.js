import{d as k,r as l,z as v,h as m,o as r,c as B,a as c,e as u,f,T as y,F as q,x as _,s as n,k as O}from"./index-CK62fWor.js";import{_ as x}from"./CustomForm.vue_vue_type_script_setup_true_lang-CDWfceke.js";import{F as W}from"./FunctionBall-HZzMzsrG.js";import"./CustomSelect.vue_vue_type_script_setup_true_lang-S8JB5u0-.js";const S={class:"container"},R=k({__name:"MemberNew",setup(C){const s=l([{label:"遊戲類別",type:"select",depValue:"game_id",required:!0},{label:"遊戲暱稱",type:"text",depValue:"nickname",required:!0},{label:"性別",type:"select",depValue:"sex",options:[{text:"男",value:"男"},{text:"女",value:"女"}]},{label:"首次交流時間",type:"date",depValue:"f_communication_time"},{label:"首次交流方式",type:"select",depValue:"f_communication_way"},{label:"首次交易金額",type:"text",depValue:"f_communication_amount"}]),o=l({}),g=[{color:"success",text:"返回",method:()=>_("/members")},{color:"primary",text:"新增",method:()=>D(),needValid:!0}],b=[{text:"新增交流方式",icon:"plus-square",method:()=>n("modalShow",!0)}],d=l([{label:"交流方式",type:"text",depValue:"communication_ways",required:!0}]),i=l(d.reduce((t,e)=>({...t,[e.depValue]:""}),{})),V=[{color:"primary",text:"新增",method:()=>h(),needValid:!0}],h=()=>{let t={collection_name:"members",update_type:"push",field_name:"communication_ways",field_value:i.communication_ways};console.log(t),m("patch","/apis/settings/",t).then(()=>{p(),n("modalShow",!1)})};v(()=>{w(),p()});const w=()=>{m("get","/apis/games").then(t=>{let e=s.findIndex(a=>a.depValue=="game_id");s[e].options=t.data.map(a=>({text:a.name,value:a.id}))})},p=()=>{m("get","/apis/settings?collection_name=members").then(t=>{let e=s.findIndex(a=>a.depValue=="f_communication_way");s[e].options=t.data.communication_ways.map(a=>({text:a,value:a}))})},D=()=>{n("loading",!0),m("post","/apis/members",F()).then(t=>{O("success",`會員 "${t.data.nickname}" 新增成功`),n("loading",!1),_("/members")}).catch(()=>{n("loading",!1)})},F=()=>{let t={};return Object.keys(o).forEach(e=>{o[e]!=""&&(t[e]=o[e]),e=="sock_puppets"&&(t[e]=o[e].split(",").map(a=>a.trim()))}),console.log(t),t};return(t,e)=>(r(),B(q,null,[c("div",S,[e[2]||(e[2]=c("h3",{class:"m-4 text-center"},"新增會員",-1)),u(x,{fields:s,buttons:g,formData:o,"onUpdate:formData":e[0]||(e[0]=a=>o=a)},null,8,["fields","formData"]),u(W,{functionList:b})]),(r(),f(y,{to:"#modal-header"},[e[3]||(e[3]=c("h2",null,"新增交流方式",-1))])),(r(),f(y,{to:"#modal-body"},[u(x,{fields:d,colSize:12,colOffset:0,buttons:V,formData:i,"onUpdate:formData":e[1]||(e[1]=a=>i=a)},null,8,["fields","formData"])]))],64))}});export{R as default};
